@inherits Patternfly.Components.Base.PatternflyComponentBase

<li class="@Classes" @attributes="AdditionalAttributes">
    <button class="pf-c-nav__link"
            id="@controlsId"
            aria-expanded="@Expanded"
            @onclick="ToggleExpanded">
        @if (Icon != null)
        {
            <span class="@Icon"></span>
        }
        @if (Text != null)
        {
            @Text
        }
        <span class="pf-c-nav__toggle">
            <span class="pf-c-nav__toggle-icon">
                <i class="fas @(Expanded?"fa-angle-down":"fa-angle-right")" aria-hidden="true"></i>
            </span>
        </span>
    </button>
    <section class="pf-c-nav__subnav"
             aria-labelledby="@controlsId"
             hidden="@(!Expanded)">
        <ul class="pf-c-nav__list">
            @ChildContent
        </ul>
    </section>
</li>

@code {
    HtmlId controlsId = new();
    [Parameter] public string? Text { get; set; } = null;
    [Parameter] public string? Icon { get; set; } = null;
    [Parameter] public RenderFragment? ChildContent { get; set; } = null;
    [Parameter] public bool Expanded { get; set; } = false;
    [Parameter] public EventCallback OnExpanded { get; set; }

    protected override void OnInitialized()
    {
        controlsId = new HtmlId();
        base.OnInitialized();
    }

    async Task ToggleExpanded()
    {
        this.Expanded = !this.Expanded;
        if (this.Expanded)
        {
            await OnExpanded.InvokeAsync();
        }
        await this.InvokeAsync(this.StateHasChanged);
    }

    protected override IEnumerable<string> OnIntroduceClasses()
    {
        var classes = new HashSet<string>(new string[] { "pf-c-nav__item", "pf-m-expandable" });
        if (this.Expanded)
            classes.Add("pf-m-expanded");

        return classes;
    }
}
