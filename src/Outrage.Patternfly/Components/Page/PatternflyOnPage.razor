@implements IDisposable
@if (ParentPage == null)
{
    @ChildContent
}

@code {
    [CascadingParameter(Name = "PatternflyParentPage")] public PatternflyPage? ParentPage { get; set; }
    [Parameter] public RenderFragment? ChildContent { get; set; }
    [Parameter] public string Id { get; set; } = Guid.NewGuid().ToString();

    [Inject] NavigationManager NavigationManager { get; set; } = default!;

    public string Uri { get; private set; } = string.Empty;

    public event Action<string> OnChange = default!;
    protected override void OnInitialized()
    {
        Uri = NavigationManager.Uri;

        if (ParentPage != null)
        {
            ParentPage.AddOnPage(this);
        }
        
        Update();
        base.OnInitialized();
    }

    public void Update()
    {
        OnChange?.Invoke(Id);
    }

    protected override bool ShouldRender()
    {
        var shouldRender = base.ShouldRender();
        if (shouldRender)
        {
            this.Update();
        }

        return shouldRender;
    }


    public void Dispose()
    {
        ParentPage?.RemoveOnPage(this);
    }
}
